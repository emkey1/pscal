#!/usr/bin/env clike
#ifdef SDL_ENABLED
// Rotating cube demo showcasing the 3D SDL/OpenGL builtins exposed to CLike.
// Requires building Pscal with SDL support (`-DSDL=ON`).

const int WIDTH = 800;
const int HEIGHT = 600;

void draw_cube() {
    glbegin("quads");

    glcolor3f(1.0, 0.0, 0.0);
    glvertex3f(-0.5, -0.5,  0.5);
    glvertex3f( 0.5, -0.5,  0.5);
    glvertex3f( 0.5,  0.5,  0.5);
    glvertex3f(-0.5,  0.5,  0.5);

    glcolor3f(0.0, 1.0, 0.0);
    glvertex3f(-0.5, -0.5, -0.5);
    glvertex3f(-0.5,  0.5, -0.5);
    glvertex3f( 0.5,  0.5, -0.5);
    glvertex3f( 0.5, -0.5, -0.5);

    glcolor3f(0.0, 0.0, 1.0);
    glvertex3f(-0.5, -0.5, -0.5);
    glvertex3f(-0.5, -0.5,  0.5);
    glvertex3f(-0.5,  0.5,  0.5);
    glvertex3f(-0.5,  0.5, -0.5);

    glcolor3f(1.0, 1.0, 0.0);
    glvertex3f(0.5, -0.5, -0.5);
    glvertex3f(0.5,  0.5, -0.5);
    glvertex3f(0.5,  0.5,  0.5);
    glvertex3f(0.5, -0.5,  0.5);

    glcolor3f(0.0, 1.0, 1.0);
    glvertex3f(-0.5,  0.5, -0.5);
    glvertex3f(-0.5,  0.5,  0.5);
    glvertex3f( 0.5,  0.5,  0.5);
    glvertex3f( 0.5,  0.5, -0.5);

    glcolor3f(1.0, 0.0, 1.0);
    glvertex3f(-0.5, -0.5, -0.5);
    glvertex3f( 0.5, -0.5, -0.5);
    glvertex3f( 0.5, -0.5,  0.5);
    glvertex3f(-0.5, -0.5,  0.5);

    glend();
}

int main() {
    int frame;
    double angle;
    int vsync_on = 1;

    initgraph3d(WIDTH, HEIGHT, "CLike SDL GL Cube", 24, 8);
    glviewport(0, 0, WIDTH, HEIGHT);
    glcleardepth(1.0);
    gldepthtest(1);
    glsetswapinterval(1);

    for (frame = 0; frame < 600; frame = frame + 1) {
        angle = frame * 0.6;

        if (frame > 0 && frame % 180 == 0) {
            vsync_on = !vsync_on;
            glsetswapinterval(vsync_on ? 1 : 0);
        }

        glclearcolor(0.1, 0.1, 0.15, 1.0);
        glclear();

        glmatrixmode("projection");
        glloadidentity();
        glscalef(1.3, 1.3, 1.3);

        glmatrixmode("modelview");
        glloadidentity();
        gltranslatef(0.0, 0.0, -0.2);
        glrotatef(angle, 1.0, 1.0, 0.0);

        glpushmatrix();
        glrotatef(angle * 0.25, 0.0, 0.0, 1.0);
        draw_cube();
        glpopmatrix();

        glswapwindow();
        graphloop(1);
    }

    closegraph3d();
    return 0;
}
#else
int main() { printf("SDL not enabled\n"); return 0; }
#endif

