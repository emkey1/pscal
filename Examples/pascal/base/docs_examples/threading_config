program ThreadingConfig;

uses
  Threading;

var
  poolLimit: string;
  handle: Integer;
  slots: Integer;
begin
  poolLimit := GetEnv('PSCAL_THREAD_POOL_SIZE');
  if poolLimit = '' then
    writeln('PSCAL_THREAD_POOL_SIZE is not set; the VM will grow up to its compile-time cap.')
  else
    writeln('PSCAL_THREAD_POOL_SIZE=', poolLimit);

  writeln('Queueing a named builtin on the shared worker pool...');
  handle := PoolSubmitNamed('delay', 'docs-example');
  WaitForThread(handle);
  if ThreadStatusOk(handle, True) then
    writeln('delay completed successfully')
  else
    writeln('delay reported an error');

  slots := ThreadStatsCount;
  writeln('ThreadStatsCount reports ', slots, ' active worker slot(s).');
end.
