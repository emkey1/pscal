#!/bin/bash
# Set PSCAL to use a different interpreter, e.g.,
#   PSCAL=/path/to/pscal ./tall

ROOT="$(cd "$(dirname "$0")/.." && pwd)"
TESTS="${TESTS:-$ROOT/Tests/Pascal}"  # all your .p / .pas files live here

PSCAL="${PSCAL:-$ROOT/build/bin/pscal}"       # plain interpreter

for f in "$TESTS/TestSuite7.p" \
         "$TESTS/MathSuite01.p" \
         "$TESTS/TestIncDecWithVerify.p" "$TESTS/tcs" "$TESTS/tb"
do
  [ -r "$f" ] || echo "Missing test file: $f"
done

if [[ ! -x "$PSCAL" ]]; then
  echo "pscal binary not found or not executable: $PSCAL" >&2
  exit 1
fi

run () {
  local label=$1; shift
  echo "=== Starting $label ==="
  "$@"
  echo "=== Finished $label ==="
  echo
}

# ---------- individual suites ----------
run "MDArray"        "$PSCAL" "$TESTS/MultiDimArrayTest.p"
run "TestSuite"      "$PSCAL" "$TESTS/TestSuite7.p"
run "MathSuite"      "$PSCAL" "$TESTS/MathSuite01.p"
run "BitwiseAndExprSuite"      "$PSCAL" "$TESTS/BitwiseAndExprSuite.p"
run "TypeTestSuite"      "$PSCAL" "$TESTS/TypeTestSuite.p"
run "FormattingTestSuite"      "$PSCAL" "$TESTS/FormattingTestSuite.p"
run "TestFileOperations"      "$PSCAL" "$TESTS/TestFileOperations.p"
run "PointerTortureTest"      "$PSCAL" "$TESTS/PointerTortureTest.p"

# assorted oneâ€‘offs
run "Assorted (tid)" "$PSCAL" "$TESTS/TestIncDecWithVerify.p"
run "Assorted (tcs)" "$PSCAL" "$TESTS/tcs"
run "Assorted (tb)"  "$PSCAL" "$TESTS/tb"

